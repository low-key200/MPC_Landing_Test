"""
配置参数文件 - 包含所有仿真和模型参数

V2版修改说明：
- 移除了与当前MPC测试无关的 `Dataset`, `SupervisedLearning`, `ReinforcementLearning` 类。
- 创建了一个专门的 `MPC` 类来存放MPC相关的参数，使结构更清晰。
- 为所有参数添加了详尽的中文注释，解释其含义和单位。
"""
import numpy as np

# =============== 仿真基本参数 ===============
DELTA_T = 0.1  # 时间步长 (秒)。这是整个系统中离散时间仿真的基本单位。
MAX_EPISODE_TIME = 20.0  # 单次仿真的最大时长 (秒)。
GRAVITY = 9.8  # 重力加速度 (m/s²)。

# =============== 四旋翼物理参数 ===============
class Quadrotor:
    """定义了四旋翼无人机的物理属性。"""
    MASS = 1.5  # 质量 (kg)
    INERTIA_MATRIX = np.array([  # 转动惯量矩阵 (kg·m²)，描述了物体对旋转运动的惯性。
        [0.01, 0.0, 0.0],
        [0.0, 0.01, 0.0],
        [0.0, 0.0, 0.02]
    ])
    # 推力重量比。这个值决定了无人机能产生的最大推力。
    # 最大推力 = THRUST_TO_WEIGHT_RATIO * MASS * GRAVITY
    THRUST_TO_WEIGHT_RATIO = 2.4
    # 三个轴上的最大角速度 (rad/s)，用于归一化MPC的控制输入。
    OMEGA_MAX = np.array([5.0, 5.0, 0.3])
    # 归一化推力的范围。MPC输出的推力值将被限制在该范围内。
    THRUST_MIN = 0.3  # 最小推力，避免电机停转。
    THRUST_MAX = 1.0  # 最大推力，对应悬停推力的 THRUST_TO_WEIGHT_RATIO 倍。

# =============== 移动平台物理参数 ===============
class MovingPlatform:
    """定义了移动平台的物理属性（基于自行车模型）。"""
    L_F = 1.0  # 质心到前轴的距离 (m)
    L_R = 1.5  # 质心到后轴的距离 (m)
    V_MAX = 2.0  # 平台能达到的最大速度 (m/s)
    HEIGHT = 0.5  # 平台着陆表面的高度 (m)，相对于地面。

# =============== MPC（模型预测控制）参数 ===============
class MPC:
    """定义了MPC专家控制器的核心参数。"""
    HORIZON = 10  # 预测时域 N。MPC会向前看10个时间步来做优化。

    # --- 状态权重 (State Weights) ---
    # 这是MPC目标函数中二次项的权重，用于惩罚状态与参考状态的偏差。
    # 权重越大，MPC会越努力地使该状态接近参考值。
    STATE_WEIGHTS = [
        # 位置误差权重 [x, y, z]
        10.0, 10.0, 20.0,
        # 速度误差权重 [vx, vy, vz]
        1.0, 1.0, 2.0,
        # 姿态误差权重 (四元数) [qw, qx, qy, qz]
        # 重点惩罚姿态偏差，特别是qx, qy，因为它们代表了roll和pitch。
        0.5, 5.0, 5.0, 0.5
    ]

    # --- 控制权重 (Control Weights) ---
    # 用于惩罚控制量的大小，目的是让控制输出更平滑，节省能量。
    CONTROL_WEIGHTS = [
        # 推力变化惩罚
        0.1,
        # 角速度变化惩罚 [wx, wy, wz]
        0.2, 0.2, 0.1
    ]

# =============== 终止条件参数 ===============
class Termination:
    """定义了仿真结束的条件。"""
    # --- 成功条件 ---
    SUCCESS_Z_MAX = 0.05  # 成功着陆时，无人机与平台的最大相对高度 (m)
    SUCCESS_XY_ERR_MAX = 0.15  # 成功着陆时，无人机在平台坐标系下的最大水平误差 (m)

    # --- 失败条件 ---
    CRASH_Z_MIN = -0.2  # 无人机低于平台表面此距离，视为坠毁 (m)
    CONTACT_Z_THRESH = 0.05  # 高度接触的判断阈值 (m)
    MAX_LANDING_VEL = 1.5  # 可接受的最大着陆接触速度 (m/s)，超过则视为着陆失败。
